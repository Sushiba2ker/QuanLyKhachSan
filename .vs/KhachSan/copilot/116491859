0{"DateTime":"2024-05-21T12:01:46.3863504Z","Version":0,"CopilotSessionId":{"Guid":"7e1d33dc-935a-41a5-b7bd-15e811838b17","ClientId":{"Id":"Microsoft.VisualStudio.Conversations.Chat.HelpWindow"}},"Request":{"Prompt":"using System;\r\nusing System.Collections.Generic;\r\nusing System.ComponentModel;\r\nusing System.Data;\r\nusing System.Diagnostics;\r\nusing System.Drawing;\r\nusing System.IO;\r\nusing System.Linq;\r\nusing System.Text;\r\nusing System.Threading.Tasks;\r\nusing System.Windows.Forms;\r\n//using Aspose.Words;\r\n//using Aspose.Words.Tables;\r\nusing iTextSharp.text;\r\nusing iTextSharp.text.pdf;\r\n\r\n\r\n\r\nnamespace KhachSan.All_User_Control\r\n{\r\n    public partial class UC_ : UserControl\r\n    {\r\n        public UC_()\r\n        {\r\n            InitializeComponent();\r\n            init();\r\n        }\r\n        private DataProvider dataProvider = new DataProvider();\r\n        private void init()\r\n        {\r\n            loadKh();\r\n            loadDv();\r\n            loadDgPay();\r\n        }\r\n        private void loadKh()\r\n        {\r\n            DataTable dt = new DataTable();\r\n            StringBuilder query = new StringBuilder(\u0022SELECT cid as [M\u00E3 Kh\u00E1ch H\u00E0ng] \u0022);\r\n            query.Append(\u0022 ,cname as [T\u00EAn kh\u00E1ch h\u00E0ng]\u0022);\r\n            query.Append(\u0022 ,rooms.roomid as [M\u00E3 ph\u00F2ng]\u0022);\r\n            query.Append(\u0022 ,roomType as[Lo\u1EA1i Ph\u00F2ng]\u0022);\r\n            query.Append(\u0022 , rooms.bed as [Lo\u1EA1i Gi\u01B0\u1EDDng]\u0022);\r\n            query.Append(\u0022 , rooms.price as [Gi\u00E1 ph\u00F2ng]\u0022);\r\n            query.Append(\u0022 ,numDays as [S\u1ED1 ng\u00E0y \u1EDF \u0111\u0103ng ki]\u0022);\r\n\r\n            query.Append(\u0022FROM customer inner join rooms ON customer.roomid = rooms.roomid \u0022);\r\n            \r\n\r\n            dt = dataProvider.execQuery(query.ToString());\r\n            dgKhachHang.DataSource = dt;\r\n        }\r\n        int maKH = 0 ; int maP; int TienPhong = 0;\r\n        private void dgKhachHang_CellClick(object sender, DataGridViewCellEventArgs e)\r\n        {\r\n            try\r\n            {\r\n                int id = e.RowIndex;\r\n                if (id \u003C 0) id = 0;\r\n                if (id == dgKhachHang.RowCount - 1) id = id - 1;\r\n\r\n                DataGridViewRow row = dgKhachHang.Rows[id];\r\n\r\n                maKH = (int)row.Cells[0].Value;\r\n                maP = (int)row.Cells[2].Value;\r\n                txtTENKH.Text = row.Cells[1].Value.ToString();\r\n                txtMaPhong.Text = row.Cells[2].Value.ToString();\r\n                txtLoaiPhong.Text = row.Cells[3].Value.ToString();\r\n                txtLoaiGiuong.Text = row.Cells[4].Value.ToString();\r\n                txtGiaPhong.Text = row.Cells[5].Value.ToString();\r\n                txtSoNgay.Text = row.Cells[6].Value.ToString();\r\n                TienPhong = Int32.Parse(txtGiaPhong.Text) * Int32.Parse(txtSoNgay.Text);\r\n                txtTienPhong.Text = TienPhong.ToString();\r\n                loadDvOFID(maKH);\r\n                \r\n            }\r\n            catch\r\n            {\r\n                MessageBox.Show(\u0022Kh\u00F4ng c\u00F3 d\u1EEF li\u1EC7u ho\u1EB7c kh\u00F4ng c\u00F3 d\u00F2ng n\u00E0o \u0111\u01B0\u1EE3c ch\u1ECDn.\u0022, \u0022Th\u00F4ng b\u00E1o\u0022, MessageBoxButtons.OK, MessageBoxIcon.Warning);\r\n\r\n            }\r\n        }\r\n       \r\n        int totalGP;\r\n        int totalDV;\r\n       \r\n        private void loadDv()\r\n        {\r\n            DataTable dt = new DataTable();\r\n            StringBuilder query = new StringBuilder(\u0022SELECT cid as [M\u00E3 Kh\u00E1ch H\u00E0ng] \u0022);\r\n            query.Append(\u0022 ,Use_services.service_id as [M\u00E3 D\u1ECBch V\u1EE5]\u0022);\r\n            query.Append(\u0022 ,services.serviceName as[T\u00EAn D\u1ECBch V\u1EE5]\u0022);\r\n            query.Append(\u0022 ,Use_services.quanlity as [S\u1ED1 L\u01B0\u1EE3ng]\u0022);\r\n            query.Append(\u0022 ,(services.price * quanlity)  as [Th\u00E0nh Ti\u1EC1n]\u0022);\r\n\r\n            query.Append(\u0022From Use_services INNER JOIN  services ON Use_services.service_id = services.serviceid INNER JOIN  customer ON Use_services.CustomerID = customer.cid\u0022);\r\n            \r\n            dt = dataProvider.execQuery(query.ToString());\r\n            dgDichVu.DataSource = dt;\r\n            \r\n        }\r\n        private void loadDvOFID(int maKH1)\r\n        {\r\n            DataTable dt = new DataTable();\r\n            StringBuilder query = new StringBuilder(\u0022SELECT cid as [M\u00E3 Kh\u00E1ch H\u00E0ng] \u0022);\r\n            query.Append(\u0022 ,service_id as [M\u00E3 D\u1ECBch V\u1EE5]\u0022);\r\n            query.Append(\u0022 ,serviceName as[T\u00EAn D\u1ECBch V\u1EE5]\u0022);\r\n            query.Append(\u0022 ,quanlity as [S\u1ED1 L\u01B0\u1EE3ng]\u0022);\r\n            query.Append(\u0022 ,(services.price * quanlity)  as [Th\u00E0nh Ti\u1EC1n]\u0022);\r\n\r\n            query.Append(\u0022From Use_services INNER JOIN  services ON Use_services.service_id = services.serviceid INNER JOIN  customer ON Use_services.CustomerID = customer.cid\u0022);\r\n            query.Append(\u0022 Where  CustomerID = \u0022\u002B maKH1);\r\n            dt = dataProvider.execQuery(query.ToString());\r\n            dgDichVu.DataSource = dt;\r\n            //TienPhong = (int)dataProvider.execScaler(\u0022SELECT sum(totalPrice) from customer where cid = \u0022 \u002B maKH);\r\n        }\r\n        private void button1_Click(object sender, EventArgs e)\r\n        {\r\n            loadDv();\r\n            loadKh(); loadDgPay();\r\n        }\r\n        private void loadDgPay()\r\n        {\r\n            DataTable dt = new DataTable();\r\n            StringBuilder query = new StringBuilder(\u0022SELECT cname as [T\u00EAn Kh\u00E1ch H\u00E0ng]\u0022);\r\n            query.Append(\u0022 ,pay.roomid as [M\u00E3 Ph\u00F2ng]\u0022);\r\n            query.Append(\u0022 ,roomType as [Lo\u1EA1i Ph\u00F2ng]\u0022);\r\n            query.Append(\u0022 ,bed as [Lo\u1EA1i Gi\u01B0\u1EDDng]\u0022);\r\n            query.Append(\u0022 ,price as [Gi\u00E1 Ph\u00F2ng]\u0022);\r\n            query.Append(\u0022 ,numDays as [S\u1ED1 ng\u00E0y \u1EDF]\u0022);\r\n            query.Append(\u0022 ,totalPrice as [Gi\u00E1 Ph\u00F2ng]\u0022);\r\n            query.Append(\u0022 ,(SELECT serviceName FROM Use_services INNER JOIN services ON Use_services.service_id = services.serviceid WHERE CustomerID = customer.cid) as [D\u1ECBch V\u1EE5 \u0110\u00E3 S\u1EED D\u1EE5ng]\u0022);\r\n            query.Append(\u0022 ,serviceMoney as [Gi\u00E1 D\u1ECBch V\u1EE5]\u0022);\r\n            query.Append(\u0022 ,total as [T\u1ED5ng ti\u1EC1n]\u0022);\r\n            query.Append(\u0022 ,paydate as [Ng\u00E0y Thanh To\u00E1n]\u0022);\r\n            query.Append(\u0022 FROM pay\u0022);\r\n            query.Append(\u0022 INNER JOIN customer ON pay.customerId = customer.cid\u0022);\r\n            query.Append(\u0022 INNER JOIN rooms ON pay.roomid = rooms.roomid\u0022);\r\n            dt = dataProvider.execQuery(query.ToString());\r\n            dgBill.DataSource = dt;\r\n        }\r\n        int TT;\r\n        private void t2ThemDichVu_Click(object sender, EventArgs e)\r\n        {\r\n            if (flag1 == true)\r\n            {\r\n               DialogResult check = MessageBox.Show(\u0022B\u1EA1n c\u00F3 ch\u1EAFc ch\u1EAFn Thanh to\u00E1n ti\u1EC1n c\u1EE7a kh\u00E1ch h\u00E0ng c\u00F3 m\u00E3 \u0022 \u002B maKH \u002B \u0022 kh\u00F4ng? \u0022, \u0022Th\u00F4ng b\u00E1o\u0022, MessageBoxButtons.YesNo, MessageBoxIcon.Question);\r\n               if(check == DialogResult.Yes)\r\n               {\r\n                    int tienDV = Int32.Parse( txtTienDV.Text );\r\n                     TT = TienPhong \u002B tienDV;\r\n                    StringBuilder query = new StringBuilder(\u0022EXEC proc_pay_them \u0022);\r\n                    query.Append(\u0022 @room_id = \u0022 \u002B maP);\r\n                    query.Append(\u0022 ,@customer_id =\u0022 \u002B maKH);\r\n                    query.Append(\u0022 ,@room_Mon = \u0022 \u002B TienPhong);\r\n                    query.Append(\u0022 ,@service_Mon = \u0022 \u002B tienDV);\r\n                    query.Append(\u0022 ,@total = \u0022 \u002B TT);\r\n                    query.Append(\u0022 ,@paydate= \u0027\u0022 \u002B dateNow.Value \u002B \u0022\u0027\u0022);\r\n                    int reslut = dataProvider.execNonQuery(query.ToString());\r\n                    if(reslut == 0)\r\n                    {\r\n                        MessageBox.Show(\u0022ADD bill kh\u00F4ng th\u00E0nh c\u00F4ng\u0022, \u0022Th\u00F4ng b\u00E1o\u0022, MessageBoxButtons.OK, MessageBoxIcon.Error);\r\n                        \r\n                    }\r\n                    else\r\n                    {\r\n                        dataProvider.execNonQuery(\u0022UPDATE rooms SET booked = \u0027NO\u0027 WHERE roomid = \u0022 \u002B maP);\r\n\r\n                        loadDgPay();\r\n                    }\r\n               }\r\n            }\r\n            else\r\n            {\r\n                MessageBox.Show(\u0022H\u00E3y t\u00EDnh T\u1ED5ng ti\u1EC1n d\u1ECBch v\u1EE5 r\u1ED3i th\u1EED lai!\u0022,\u0022Th\u00F4ng b\u00E1o\u0022,MessageBoxButtons.OK,MessageBoxIcon.Error);\r\n            }\r\n        }\r\n        bool flag1 = false;\r\n        private void btnTnDV_Click(object sender, EventArgs e)\r\n        {\r\n            object res = dataProvider.execScaler(\u0022SELECT SUM(Use_services.quanlity*services.price) FROM services inner join Use_services on service_id = serviceid WHERE customerID = \u0022 \u002B maKH);\r\n            if (res != null) \r\n            {\r\n                if (int.TryParse(res.ToString(), out int tienDichVu))\r\n                {\r\n                    txtTienDV.Text = tienDichVu.ToString();\r\n                    flag1 = true;  \r\n                }\r\n            }\r\n            \r\n\r\n        }\r\n\r\n        private void button2_Click(object sender, EventArgs e)\r\n        {\r\n            try\r\n            {\r\n                // Get the selected row\r\n                DataGridViewRow selectedRow = dgBill.CurrentRow;\r\n                if (selectedRow == null)\r\n                {\r\n                    MessageBox.Show(\u0022No row selected in dgBill\u0022);\r\n                    return;\r\n                }\r\n\r\n                // Create a new PDF document\r\n                Document document = new Document();\r\n                string path = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, \u0022BillPrint.pdf\u0022);\r\n                PdfWriter writer = PdfWriter.GetInstance(document, new FileStream(path, FileMode.Create));\r\n                document.Open();\r\n\r\n                Chunk titleChunk = new Chunk(\u0022Hotel Bill\u0022, FontFactory.GetFont(\u0022Arial\u0022, 25, iTextSharp.text.Font.BOLD, BaseColor.RED));\r\n                Paragraph title = new Paragraph(titleChunk) { Alignment = Element.ALIGN_CENTER };\r\n                document.Add(title);\r\n\r\n                // Create a table to hold content\r\n                PdfPTable table = new PdfPTable(1);\r\n                table.TotalWidth = 500f;\r\n                table.LockedWidth = true;\r\n\r\n                // Add content to the table\r\n                table.AddCell(\u0022Name Customer: \u0022 \u002B selectedRow.Cells[\u0022T\u00EAn Kh\u00E1ch H\u00E0ng\u0022].Value.ToString());\r\n                table.AddCell(\u0022Room: \u0022 \u002B selectedRow.Cells[\u0022M\u00E3 Ph\u00F2ng\u0022].Value.ToString());\r\n                table.AddCell(\u0022Type Room: \u0022 \u002B selectedRow.Cells[\u0022Lo\u1EA1i Ph\u00F2ng\u0022].Value.ToString());\r\n                table.AddCell(\u0022Type Bed: \u0022 \u002B selectedRow.Cells[\u0022Lo\u1EA1i Gi\u01B0\u1EDDng\u0022].Value.ToString());\r\n                table.AddCell(\u0022Price Room: \u0022 \u002B selectedRow.Cells[\u0022Gi\u00E1 Ph\u00F2ng\u0022].Value.ToString());\r\n                table.AddCell(\u0022Num Day: \u0022 \u002B (selectedRow.Cells[\u0022S\u1ED1 ng\u00E0y \u1EDF\u0022].Value != DBNull.Value ? selectedRow.Cells[\u0022S\u1ED1 ng\u00E0y \u1EDF\u0022].Value.ToString() : \u00220\u0022));\r\n                table.AddCell(\u0022Used Service: \u0022 \u002B selectedRow.Cells[\u0022D\u1ECBch V\u1EE5 \u0110\u00E3 S\u1EED D\u1EE5ng\u0022].Value.ToString()); // The service used\r\n                table.AddCell(\u0022Price Service: \u0022 \u002B (selectedRow.Cells[\u0022Gi\u00E1 D\u1ECBch V\u1EE5\u0022].Value != DBNull.Value ? selectedRow.Cells[\u0022Gi\u00E1 D\u1ECBch V\u1EE5\u0022].Value.ToString() : \u00220\u0022));\r\n                table.AddCell(\u0022Total: \u0022 \u002B selectedRow.Cells[\u0022T\u1ED5ng ti\u1EC1n\u0022].Value.ToString());\r\n                table.AddCell(\u0022Date Pay: \u0022 \u002B selectedRow.Cells[\u0022Ng\u00E0y Thanh To\u00E1n\u0022].Value.ToString());\r\n\r\n                // Add the table to the document\r\n                document.Add(table);\r\n\r\n                // Add thank you note to the document\r\n                document.Add(new Paragraph(\u0022Thank you for using our service! We look forward to serving you in the near future.\u0022));\r\n\r\n                // Close the document\r\n                document.Close();\r\n\r\n                // Open the document\r\n                Process.Start(new ProcessStartInfo(\u0022BillPrint.pdf\u0022) { UseShellExecute = true });\r\n\r\n                // Remove the selected row from dgBill\r\n                if (dgBill.SelectedRows.Count \u003E 0)\r\n                {\r\n                    dgBill.Rows.RemoveAt(dgBill.SelectedRows[0].Index);\r\n                }\r\n\r\n                // Remove the selected row from dgDichVu\r\n                if (dgDichVu.SelectedRows.Count \u003E 0)\r\n                {\r\n                    dgDichVu.Rows.RemoveAt(dgDichVu.SelectedRows[0].Index);\r\n                }\r\n\r\n                // Remove the selected row from dgKhachHang\r\n                if (dgKhachHang.SelectedRows.Count \u003E 0)\r\n                {\r\n                    dgKhachHang.Rows.RemoveAt(dgKhachHang.SelectedRows[0].Index);\r\n                }\r\n            }\r\n            catch (Exception ex)\r\n            {\r\n                MessageBox.Show(\u0022An error occurred: \u0022 \u002B ex.Message);\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\nSystem.NullReferenceException: \u0027Object reference not set to an instance of an object.\u0027","Context":{"VisibleDocuments":[],"PreSelectedSkill":null,"CorrelationId":{"Guid":"00000000-0000-0000-0000-000000000000"}}},"Response":{"Content":"The \u0060System.NullReferenceException: \u0027Object reference not set to an instance of an object.\u0027\u0060 error typically occurs when you try to access a member of a type (for example, a method or a property) on a variable that currently holds \u0060null\u0060. \n\nIn your code, this could be happening in several places, as there are many instances where you are accessing properties or methods of objects that could potentially be \u0060null\u0060. \n\nFor example, in the \u0060dgKhachHang_CellClick\u0060 method, you are accessing the \u0060Value\u0060 property of a \u0060DataGridViewCell\u0060 that could potentially be \u0060null\u0060. If the cell does not exist in the row, this would result in a \u0060NullReferenceException\u0060.\n\n\u0060\u0060\u0060csharp\nmaKH = (int)row.Cells[0].Value;\n\u0060\u0060\u0060\n\nTo fix this, you should add null checks before accessing properties or methods of objects. Here\u0027s how you could adjust the above line of code:\n\n\u0060\u0060\u0060csharp\nif (row.Cells[0] != null)\n{\n    maKH = (int)row.Cells[0].Value;\n}\n\u0060\u0060\u0060\n\nYou should apply this principle throughout your code to avoid \u0060NullReferenceException\u0060 errors.","Type":0,"Status":1,"FollowUpPrompts":["Can you show me how to add null checks in other parts of my code?","Can you explain more about the NullReferenceException?"]},"SelectedFunctionName":"Explain","LoggedSkillInvocations":null,"ThreadName":null}
